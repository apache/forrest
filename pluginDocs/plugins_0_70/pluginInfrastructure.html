<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta content="Apache Forrest" name="Generator">
<meta name="Forrest-version" content="0.9-dev">
<meta name="Forrest-skin-name" content="pelt">
<title>Plugin Infrastructure (v0.7)</title>
<link type="text/css" href="../../skin/basic.css" rel="stylesheet">
<link media="screen" type="text/css" href="../../skin/screen.css" rel="stylesheet">
<link media="print" type="text/css" href="../../skin/print.css" rel="stylesheet">
<link type="text/css" href="../../skin/profile.css" rel="stylesheet">
<script src="../../skin/getBlank.js" language="javascript" type="text/javascript"></script><script src="../../skin/getMenu.js" language="javascript" type="text/javascript"></script><script src="../../skin/fontsize.js" language="javascript" type="text/javascript"></script>
<link rel="shortcut icon" href="../../favicon.ico">
</head>
<body onload="init()">
<script type="text/javascript">ndeSetTextSize();</script>
<div id="top">
<!--+
    |breadtrail
    +-->
<div class="breadtrail">
<a href="http://www.apache.org/">apache</a> &gt; <a href="http://forrest.apache.org/">forrest</a><script src="../../skin/breadcrumbs.js" language="JavaScript" type="text/javascript"></script>
</div>
<!--+
    |header
    +-->
<div class="header">
<!--+
    |start group logo
    +-->
<div class="grouplogo">
<a href="http://www.apache.org/"><img class="logoImage" alt="Apache" src="../../images/apache-forrest.png" title="The Apache Software Foundation"></a>
</div>
<!--+
    |end group logo
    +-->
<!--+
    |start Project Logo
    +-->
<div class="projectlogo">
<a href="http://forrest.apache.org/"><img class="logoImage" alt="Forrest" src="../../images/project-logo.gif" title="Apache Forrest"></a>
</div>
<!--+
    |end Project Logo
    +-->
<!--+
    |start Search
    +-->
<div class="searchbox">
<form action="http://www.google.com/search" method="get" class="roundtopsmall">
<input value="forrest.apache.org" name="sitesearch" type="hidden"><input onFocus="getBlank (this, 'Search the site with google');" size="25" name="q" id="query" type="text" value="Search the site with google">&nbsp; 
                    <input name="Search" value="Search" type="submit">
</form>
</div>
<!--+
    |end search
    +-->
<!--+
    |start Tabs
    +-->
<ul id="tabs">
<li>
<a class="unselected" href="../../index.html">Welcome</a>
</li>
<li>
<a class="unselected" href="../../contrib.html">Developers</a>
</li>
<li>
<a class="unselected" href="../../versions/index.html">Versioned Docs</a>
</li>
<li class="current">
<a class="selected" href="../../pluginDocs/index.html">Plugins</a>
</li>
<li>
<a class="unselected" href="../../tools/index.html">Tools</a>
</li>
</ul>
<!--+
    |end Tabs
    +-->
</div>
</div>
<div id="main">
<div id="publishedStrip">
<!--+
    |start Subtabs
    +-->
<div id="level2tabs">
<a class="unselected" href="../../pluginDocs/plugins_0_80/index.html">0.80 (current)</a><a class="unselected" href="../../pluginDocs/plugins_0_90/index.html">0.90-dev (under development)</a><a class="selected" href="../../pluginDocs/plugins_0_70/index.html">0.70 (past)</a>
</div>
<!--+
    |end Endtabs
    +-->
<script type="text/javascript"><!--
document.write("Last Published: " + document.lastModified);
//  --></script>
</div>
<!--+
    |breadtrail
    +-->
<div class="breadtrail">

             &nbsp;
           </div>
<!--+
    |start Menu, mainarea
    +-->
<!--+
    |start Menu
    +-->
<div id="menu">
<div onclick="SwitchMenu('menu_selected_1.1', '../../skin/')" id="menu_selected_1.1Title" class="menutitle" style="background-image: url('../../skin/images/chapter_open.gif');">0.70 Plugins</div>
<div id="menu_selected_1.1" class="selectedmenuitemgroup" style="display: block;">
<div class="menuitem">
<a href="../../pluginDocs/plugins_0_70/index.html">Index</a>
</div>
<div class="menuitem">
<a href="../../pluginDocs/plugins_0_70/usingPlugins.html">Using Plugins</a>
</div>
<div class="menupage">
<div class="menupagetitle">Plugin Infrastructure</div>
</div>
</div>
<div id="credit">
<hr>
        This is documentation for current version v0.7
       (<a href="http://forrest.apache.org/pluginDocs/">More</a>)</div>
<div id="roundbottom">
<img style="display: none" class="corner" height="15" width="15" alt="" src="../../skin/images/rc-b-l-15-1body-2menu-3menu.png"></div>
<!--+
  |alternative credits
  +-->
<div id="credit2">
<a href="http://us.apachecon.com/"><img border="0" title="ApacheCon US 2008" alt="ApacheCon US 2008 - logo" src="http://apache.org/ads/ApacheCon/2008-usa-125x125.png" style="width: 125px;height: 125px;"></a>
</div>
</div>
<!--+
    |end Menu
    +-->
<!--+
    |start content
    +-->
<div id="content">
<div title="Portable Document Format" class="pdflink">
<a class="dida" href="pluginInfrastructure.pdf"><img alt="PDF -icon" src="../../skin/images/pdfdoc.gif" class="skin"><br>
        PDF</a>
</div>
<div class="trail">Font size: 
	          &nbsp;<input value="Reset" class="resetfont" title="Reset text" onclick="ndeSetTextSize('reset'); return false;" type="button">      
	          &nbsp;<input value="-a" class="smallerfont" title="Shrink text" onclick="ndeSetTextSize('decr'); return false;" type="button">
	          &nbsp;<input value="+a" class="biggerfont" title="Enlarge text" onclick="ndeSetTextSize('incr'); return false;" type="button">
</div>
<h1>Plugin Infrastructure</h1>
<div id="front-matter">
<div id="motd-area">
        This is documentation for current version v0.7
       (<a href="http://forrest.apache.org/pluginDocs/">More</a>)</div>
<div id="minitoc-area">
<ul class="minitoc">
<li>
<a href="#overview">Overview</a>
</li>
<li>
<a href="#What+is+a+Forrest+Plugin%3F">What is a Forrest Plugin?</a>
<ul class="minitoc">
<li>
<a href="#pluginTypes">Types of Plugin</a>
<ul class="minitoc">
<li>
<a href="#inputPlugins">Input Plugins</a>
</li>
<li>
<a href="#outputPlugins">Output Plugins</a>
</li>
<li>
<a href="#internalPlugins">Internal Plugins</a>
</li>
</ul>
</li>
<li>
<a href="#Naming+Conventions">Naming Conventions</a>
</li>
<li>
<a href="#An+Example+Plugin">An Example Plugin</a>
</li>
</ul>
</li>
<li>
<a href="#What+Does+a+Forrest+Plugin+Look+Like%3F">What Does a Forrest Plugin Look Like?</a>
<ul class="minitoc">
<li>
<a href="#The+IMS+Manifest+Plugin">The IMS Manifest Plugin</a>
</li>
</ul>
</li>
<li>
<a href="#How+does+Installation+work%3F">How does Installation work?</a>
</li>
<li>
<a href="#Further+Reading">Further Reading</a>
</li>
</ul>
</div>
</div>
    
<a name="N1000D"></a><a name="overview"></a>
<h2 class="underlined_10">Overview</h2>
<div class="section">
<p>
        Forrest can be extended with the addition of plugins. This document
        describes what a plugin is and outlines the plugin infrastructure so
        that you can start building your own Forrest extensions.
      </p>
</div>
    
<a name="N10017"></a><a name="What+is+a+Forrest+Plugin%3F"></a>
<h2 class="underlined_10">What is a Forrest Plugin?</h2>
<div class="section">
<p>
        A Forrest plugin is a set of resources and configuration files that
        extend the functionality of Forrest. They will typically consist of a
        sitemap, zero or more stylesheets and zero or more schemas.
      </p>
<p>
        The plugins sitemap is mounted by Forrest's sitemap after the project
        specific sitemap but before the Forrest default matchers. This allows a
        plugin to override/extend default Forrest behaviour. By adopting a
        plugin model we can keep the core of Forrest tightly focused on the
        basic functionality, whilst still facilitating extensions to suit
        individual projects needs.
      </p>
<a name="N10023"></a><a name="pluginTypes"></a>
<h3 class="underlined_5">Types of Plugin</h3>
<p>
          There are three types of plugin, <span class="codefrag">input</span>,
          <span class="codefrag">output</span> and <span class="codefrag">internal</span>. Each plugin has a
          specific role to play and extends a different part of Forrest:
        </p>
<pre class="code">
                            internal plugins
                       (site.xml, abs-linkmap etc.)
                                   |
                                  \|/
                                   .
          input format --&gt; intermediate format --&gt; output format 
                        .                       .
                       /|\                     /|\
                        |                       |
                   input plugin            output plugin
                     (**.xml)         (**.html, **.pdf etc.) 
</pre>
<p>
          The name of the sitemap will reflect the type of plugin in use. That
          is, an internal plugin will have a sitemap called
          <span class="codefrag">internal.xmap</span>, an output plugin has
          <span class="codefrag">output.xmap</span> and an input plugin has
          <span class="codefrag">input.xmap</span>. In addition, an input plugin can optionally
          provide a <span class="codefrag">resources.xmap</span>.
        </p>
<a name="N10048"></a><a name="inputPlugins"></a>
<h4>Input Plugins</h4>
<p>
            Input plugins provide a new source format. For example, the
            OpenOffice.org plugin extends Forrest to allow the use of
            OpenOffice.org Application file formats.
          </p>
<p>
            An input plugin provides an <span class="codefrag">input.xmap</span> file. This
            provides the source matchers (i.e. **.xml), it is mounted in
            forrest.xmap before the default forrest **.xml behaviour and
            therefore can override that default behaviour but it will not
            interfere with any internal Forrest infrastructure matches, or any
            other plugins infrastructure matches.
          </p>
<p>
            An input plugin may also provide a <span class="codefrag">resources.xmap</span> file.
            This can be used to match additional resources that are not stored
            in XML files, for example, javascript files.
          </p>
<a name="N1005E"></a><a name="outputPlugins"></a>
<h4>Output Plugins</h4>
<p>
            Output plugins provide a new output format. For example, the s5
            plugin extends Forrest to produce HTML slides from Forrest
            documents.
          </p>
<p>
            An output plugin provides an <span class="codefrag">output.xmap</span> file. This
            provides the relevant output matchers (i.e. **.html, **.pdf,
            **.slides), it is mounted before any of the default matchers for
            Forrest and so can override this default behaviour.
          </p>
<a name="N1006E"></a><a name="internalPlugins"></a>
<h4>Internal Plugins</h4>
<p>
            Internal plugins are for advanced use only. They provide ways of
            extending or overriding Forrest's internal operations. For example,
            the IMSManifest plugin allows Forrest projects to use an IMS
            Manifest file instead of a site.xml and tabs.xml configuration
            files.
          </p>
<p>
            Internal plugins provide an <span class="codefrag">internal.xmap</span> file. This
            provides the infrastructure matchers (i.e. site.xml, faq.xml,
            issues.xml), and will be mounted before *any* of the Forrest
            matches. This sitemap can override any behaviour within Forrest and
            so developers of these plugins must be especially careful with the
            construction of their matchers, since they will be processed before
            any other matchers and consequently can easily break existing
            functionality. You must only do a &lt;map:generate ...&gt; if you
            are certain you are going to process the full result.
          </p>
<a name="N1007F"></a><a name="Naming+Conventions"></a>
<h3 class="underlined_5">Naming Conventions</h3>
<p>
          Technically you can name a plugin anything you like with one small
          restriction (see below). However, we do have some naming conventions
          that we recomend you follow. This is to minimise the chances of
          collision between plugins from different developers.
        </p>
<p>
          The name should be structured like a java package name, and should
          include a relevant reverse domain name. For example:
        </p>
<pre class="code">org.apache.forrest.plugin.PLUGIN_TYPE.PLUGIN_NAME</pre>
<pre class="code">net.sf.forrestPlugins.PLUGIN_TYPE.PLUGIN_NAME</pre>
<p>
          Where <span class="codefrag">PLUGIN_TYPE</span> is either "internal", "input" or
          "output" and <span class="codefrag">PLUGIN_NAME"</span> is a suitable name chosen by
          yourself.
        </p>
<div class="warning">
<div class="label">Warning</div>
<div class="content">
          Plugin names cannot have a '-' character in them. This character is
          used to indicate the start of a version number when defining a plugin
          to be used. See <a href="../../pluginDocs/plugins_0_90/usingPlugins.html">Using Plugins</a> for
          more information.
        </div>
</div>
<a name="N100A4"></a><a name="An+Example+Plugin"></a>
<h3 class="underlined_5">An Example Plugin</h3>
<p>
          In order to fully understand the applicability of Forrest Plugins we
          will consider an extension to the way in which Forrest defines the
          structure of the site. By default Forrest uses a site.xml file to
          define navigation through the site and a tabs.xml file to define the
          tabs across the top of the page. But what if we want to use a
          different file to describe site structure? For example, what if we
          want to use an IMS Manifest file from the SCORM content package
          standards (http://www.adlnet.org/).
        </p>
<p>
          An IMS Manifest file describes the structure of a site. It is also
          possible to define a set of rules for extracting tab information from
          such a file. Consequently, it is possible to use an IMSManifest file
          to create Forrest's site.xml and tabs.xml files. The advantage would
          be that we can then use SCORM compliant content objects within
          Forrest.
        </p>
<p>
          Unfortunately, IMS Manifests are much more complex than site.xml and
          tabs.xml files. Therefore, not all users will want to use them. Adding
          the functionality as an optional plugin seems to be the ideal
          solution.
        </p>
</div>
    
<a name="N100B5"></a><a name="What+Does+a+Forrest+Plugin+Look+Like%3F"></a>
<h2 class="underlined_10">What Does a Forrest Plugin Look Like?</h2>
<div class="section">
<p>
        Plugins will need to conform to a specified directory structure. This
        mirrors the default forrest directory structure:
      </p>
<pre class="code">
[plugin_name]
  |
  |-- config files (xmap, skinconf etc.)
  |
  |-- resources
      |
      |-- schema
      |   |
      |   |-- catalog.xcat
      |   |
      |   |-- dtd (DTDs etc.)
      |
      |-- stylesheets (XSLs etc.)
</pre>
<a name="N100C2"></a><a name="The+IMS+Manifest+Plugin"></a>
<h3 class="underlined_5">The IMS Manifest Plugin</h3>
<p>
          If we consider the IMS Manifest Plugin described above, we see that we
          will need the following files and directory structure:
        </p>
<pre class="code">
org.apache.forrest.plugin.internal.IMSManifest
  |
  |-- internal.xmap
  |
  |-- resources
      |
      |-- stylesheets
                    |
                    |- imsmanifest2site.xsl
                    |- imsmanifest2tabs.xsl
                    |- pathutils.xsl
                    |- repositoryUtils.xsl
</pre>
<p>
          The internal.xmap file will override the default behaviour for the
          navigation generation matchers in Forrest, for example, it contains a
          matcher as follows:
        </p>
<pre class="code">

&lt;map:match pattern="abs-menulinks"&gt;
  &lt;map:select type="exists"&gt;
    &lt;map:when test="{properties:content.xdocs}imsmanifest.xml"&gt;
       &lt;map:generate src="{properties:content.xdocs}imsmanifest.xml" /&gt;
       &lt;map:transform src="resources/stylesheets/imsmanifest2site.xsl"/&gt;
       &lt;map:transform src="{forrest:forrest.stylesheets}/absolutize-linkmap.xsl" /&gt;
       &lt;map:transform src="{forrest:forrest.stylesheets}/site2site-normalizetabs.xsl" /&gt;
     &lt;map:serialize type="xml"/&gt;
   &lt;/map:when&gt;
   &lt;map:when test="{properties:content.xdocs}site.xml"&gt;
      &lt;map:generate src="{properties:content.xdocs}site.xml" /&gt;
      &lt;map:transform src="{forrest:forrest.stylesheets}/absolutize-linkmap.xsl" /&gt;
      &lt;map:transform src="{forrest:forrest.stylesheets}/site2site-normalizetabs.xsl" /&gt;
      &lt;map:transform src="{forrest:forrest.stylesheets}/normalizehrefs.xsl"/&gt;
    &lt;map:serialize type="xml"/&gt;
  &lt;/map:when&gt;
  &lt;/map:select&gt;
&lt;/map:match&gt;

        </pre>
<div class="note">
<div class="label">Note</div>
<div class="content">
          Note that this matcher will default to the behaviour provided by
          Forrest if there is no imsmanifest.xml file present in the project. At
          present it is necessary to copy this default behaviour from the
          original Forrest *.xmap files. We hope to improve on this in the
          future.
        </div>
</div>
</div>
    
<a name="N100DB"></a><a name="How+does+Installation+work%3F"></a>
<h2 class="underlined_10">How does Installation work?</h2>
<div class="section">
<p>
        When Forrest installs a plugin it downloads a zip of the plugin code and
        extracts it into the <span class="codefrag">plugins</span> directory of Forrest and an
        entry is made in <span class="codefrag">src/plugins/[input|internal|output].xmap</span>
        (recall the actual sitemap name is dependant on the type of plugin it
        belongs to. For example, installing the IMSManifest plugin described
        above will result in the following entry being added to the plugin
        sitemap:
      </p>
<pre class="code">

&lt;map:select type="exists"&gt;
  &lt;map:when test="input.xmap"&gt;
    &lt;map:mount uri-prefix="" 
      src="sitemap.xmap" 
      check-reload="yes" 
      pass-through="true"/&gt;
  &lt;/map:when&gt;
&lt;/map:select&gt;
  
      </pre>
<p>
        Installed plugins are managed by the
        FORREST_INSTALL_DIR/build/plugins/sitemap.xmap file. This file is
        mounted by the main Forrest sitemap with the following code:
      </p>
<pre class="code">

        &lt;map:pipeline internal-only="false"&gt;
           &lt;map:mount uri-prefix=""
                      src="{forrest:forrest.plugins}/sitemap.xmap"
                      check-reload="yes"
                      pass-through="true"/&gt;
        &lt;/map:pipeline&gt;
  
      </pre>
<div class="note">
<div class="label">Note</div>
<div class="content">
        The above plugin sitemap.xmap file is automatically managed by Forrest,
        the end user need never edit this file.
      </div>
</div>
</div>
    
<a name="N100F9"></a><a name="Further+Reading"></a>
<h2 class="underlined_10">Further Reading</h2>
<div class="section">
<p>
        If you want to build a plugin you might like to start with our
        <a href="../../docs_0_70/howto/howto-buildPlugin.html">HowTo on Building Plugins</a>.
      </p>
</div>
  
</div>
<!--+
    |end content
    +-->
<div class="clearboth">&nbsp;</div>
</div>
<div id="footer">
<!--+
    |start bottomstrip
    +-->
<div class="lastmodified">
<script type="text/javascript"><!--
document.write("Last Published: " + document.lastModified);
//  --></script>
</div>
<div class="copyright">
        Copyright &copy;
         2002-2008 <a href="http://www.apache.org/licenses/">The Apache Software Foundation.</a>
</div>
<!--+
    |end bottomstrip
    +-->
</div>
</body>
</html>
