<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
        <link href="../themes/common.css" media="screen" rel="alternate stylesheet" title="common" type="text/css" />
        <link href="../themes/leather-dev.css" media="screen" rel="alternate stylesheet" title="common" type="text/css" />
        <link href="../themes/pelt.screen.css" media="screen" rel="stylesheet" title="Pelt" type="text/css" />
        
        <link href="../int/index.dispatcher.css" media="screen" rel="stylesheet" title="Pelt" type="text/css" />
        <link href="../themes/pelt.print.css" media="print" rel="stylesheet" title="Pelt" type="text/css" />
        <style type="text/css">/* Extra css */ 
p.quote {
 margin-left: 2em; 
 padding: .5em; 
 background-color: #f0f0f0; 
 font-family: monospace; 
}</style>
      <meta content="Apache Forrest" name="Generator" />
<meta content="0.8" name="Forrest-version" />
<meta content="pelt" name="Forrest-theme-name" />
<meta content="text/html; charset=UTF-8" http-equiv="content-type" />
<!--+ |start navigation links +-->
<link href="../index.html" rel="Index" title="Index..." />
<link href="../linkmap.html" rel="CONTENTS" title="Site map..." />
<!--+ |end navigation links +-->
<!--+|start favicon +-->
<link href="../favicon.ico" rel="shortcut icon" />
<!--+|start favicon +-->
<script language="javascript" src="../themes/getBlank.js" type="text/javascript"> </script>
<script src="../themes/menu.js" type="text/javascript"> </script>
<!--+ |start content-title +-->
<title>Living on the edge.</title>
<!--+ |end content-title +-->
</head>
<body>
<div id="container">
<!--+
    | start breadtrail
    +-->
<div class="breadtrail">
<a href="http://forrest.apache.org/">Apache Forrest</a>
<script src="../themes/breadcrumbs.js" type="text/javascript"> </script>
</div>
<!--+
    | end breadtrail
    +-->
<div id="header">
<div id="branding-tagline-name">new 
            seed</div>
<div id="branding-tagline-tagline">powered by the 
            dispatcher</div>
<div class="logo">
<!--+
    |start Logo
    +-->
<a href="http://forrest.apache.org/">
<img alt="Apache Forrest Logo" class="logoImage" src="../images/project-logo.gif" title="Apache Forrest" />
</a>
<!--+
    |end group Logo
    +-->
</div>
<div class="logo">
<!--+
    |start Logo
    +-->
<a href="http://forrest.apache.org/pluginDocs/">
<img alt="plugin logo" class="logoImage" src="../images/project.png" title="org.apache.forrest.plugin.internal.dispatcher plugin for Apache Forrest" />
</a>
<!--+
    |end group Logo
    +-->
</div>
<!--+
  |start Search
  +-->
<div class="searchbox">
<div class="round-top-left-small">
<div class="round-top-right-small">
<div class="search-input">
<form action="http://www.google.com/search" method="get">
<div class="search-hidden">
<input name="sitesearch" type="hidden" value="mydomain" />
</div>
<div class="search-field">
<input name="q" onBlur="getPrompt(this, 'Search the site with google');" onFocus="getBlank(this, 'Search the site with google');" size="25" type="text" value="Search the site with google" />
</div>
<div class="search-submit">
<input name="Search" type="submit" value="Search" />
</div>
</form>
</div>
</div>
</div>
</div>
<!--+ |end search +-->
<div id="nav-main-hook">
<!--+ |start Tabs new +-->
<ul id="nav-main">
<li>
<a class="base-not-selected" href="http://forrest.apache.org/pluginDocs">Forrest Plugins</a>
</li>
<li>
<a class="base-not-selected" href="../index.html">Home</a>
</li>
<li>
<a class="base-not-selected" href="../how/howto-dispatcher-quickstart.html">HowTo</a>
</li>
<li class="current">
<a class="base-selected" href="../int/index.html">Internals</a>
</li>
</ul>
<!--+ |end Tabs +-->
<div id="publishedStrip"> <!--+
    |start nav-main-sub
    +--><!--+
    |end Endtabs
    +--><script type="text/javascript">document.write("Last Published: " + document.lastModified);</script>
</div>
</div>
</div>
<div id="page">
<div class="breadtrail"> </div>
<div id="leftbar">
<!--+ |start 0 menu +-->
<!--+ |start Menu +-->
<div id="nav-section">
<ul>
<li class="pagegroupselected" id="menu_selected_1.1Title">
<span onclick="SwitchMenu('menu_selected_1.1')">Internals</span>
<ul class="&#10;               selectedmenuitemgroup" id="menu_selected_1.1">
<li class="menupage">
<div class="menupagetitle">Overview</div>
</li>
</ul>
</li>
</ul>
</div>
<!--+ |end menu +-->
<!--+ |start content-motd-page +-->
<!--+ |end content-motd-page +-->
<div id="roundbottom">
<div id="roundbottomLeft">
<img alt="spacer" src="../themes/images/spacer.gif" />
</div>
</div>
</div>
<div id="content">
<!--+ |start content-title +-->
<h1 class="content-title">Living on the edge.</h1>
<!--+ |end content-title +-->
<!--+ |start content-abstract +-->
<!--+ |end content-abstract +-->
<!--+ |start content-minitoc +-->
<div id="content-minitoc-area">
<ul class="minitoc">
<li>
<a href="#introduction">Introduction</a>
</li>
<li>
<a href="#fpx">forrest.properties.xml</a>
</li>
<li>
<a href="#lm">locationmap.xml</a>
<ul class="minitoc">
<li>
<a href="#handson">Hands on the lm</a>
</li>
</ul>
</li>
</ul>
</div>
<!--+ |end minitoc +-->
<!--+ |start content-main +-->
<a name="introduction" title="Introduction"> </a>
<h2 class="underlined_10">Introduction</h2>
<div class="section">
<p> Since the dispatcher is in the whiteboard, we can afford to use the 
        latest features available in forrest. This helps to test these new 
        features and to be prepared for the future when this feature is 
        standard.</p>
</div>
<a name="fpx" title="forrest.properties.xml"> </a>
<h2 class="underlined_10">forrest.properties.xml</h2>
<div class="section">
<p> We needed to prevent having references from the core to a plugin. 
        This can be done with the new properties system. You can override any 
        of the following values via a <span class="codefrag">forrest.properties.xml</span> in your 
        project.</p>
<pre class="code">  &lt;property name="dispatcher.theme" value="pelt"/&gt;
  &lt;property name="dispatcher.fallback.theme" value="common"/&gt;
  &lt;property name="dispatcher.theme-ext" value=".fv"/&gt;
  &lt;property name="dispatcher.fallback.theme-ext" value=".fv"/&gt;
  &lt;property name="dispatcher.themer" value="org.apache.forrest.themes.core"/&gt;
  &lt;property name="dispatcher.home" value="org.apache.forrest.plugin.internal.dispatcher"/&gt;
      </pre>
</div>
<a name="lm" title="locationmap.xml"> </a>
<h2 class="underlined_10">locationmap.xml</h2>
<div class="section">
<p> One of the main features of the dispatcher is its fallback mechanism. 
        We are not only looking into one or two places but a sophisticated list 
        of locations. These locations are defined in the locationmap.xml. Like 
        with the forrest.properties.xml you can override any match in there by 
        implementing it in your project locationmap.xml.</p>
<a name="handson" title="Hands on the lm"> </a>
<h3 class="underlined_5">Hands on the lm</h3>
<p>The resolving process of the structurer responsible for the URL 
            has implemented a high amount of fallbacks. Let us have a look.</p>
<pre class="code">&lt;match pattern="resolve.structurer.**"&gt;
  &lt;!-- 
      FIXME - Problem with the pattern
      ********************************
      We have encountered a strange problem with the pattern 'resolve.structurer.**'.
      The {1} sometimes matches nothing, whereas {../1} is OK.
      On the contrary, the {../1} sometimes matches nothing, whereas {1} is OK.
      As a temporary workaround, we put {../1}{1} which covers all the cases.
      CF. FOR-893
      
      structurer templating
      *********************
      URL specific structurer templates (project-based) e.g. index.fv
      * either in the structurer/url
      * or in the xdocs dir [depreciated]
      have priority *before* 
      
      a) sourcetype based e.g. document-v20.fv
      b) resourceTypeAction based on meta data e.g. xhtml.fv
      (demonstrates lenya meta data integration for DOCO)
      c) RecursiveDirectoryTraversalAction e.g. samples/common.fv
      c1) url dir
      c2) xdocs dir [depreciated]
     
      If no structurer template can be found in the project, 
      we use either the templates provided by the
      a) custom implementation of the themes.core plugin
      b) themes.core plugin
      where we test for 
      1) {properties:dispatcher.theme}{properties:dispatcher.theme-ext}
      2) {properties:dispatcher.fallback.theme}{properties:dispatcher.fallback.theme-ext}
      --&gt;
  &lt;select type="exists"&gt;
    &lt;!-- project-based 
          url-based (url location) --&gt;
    &lt;location 
      src="{properties:resources}/structurer/url/{1}{properties:dispatcher.theme-ext}" 
      /&gt;
    &lt;!-- project-based 
          url-based (xdocs location)  [depreciated]--&gt;
    &lt;location src="{properties:content.xdocs}{1}{properties:dispatcher.theme-ext}" /&gt;
    &lt;act type="sourcetype" src="{properties:content.xdocs}{1}.xml"&gt;
      &lt;!-- Sourcetype based 
          http://forrest.apache.org/docs/cap.html--&gt;
      &lt;location src="lm://dispatcher.structurer.resourceType.{sourcetype}" /&gt;
    &lt;/act&gt;
    &lt;act type="resourceTypeAction"&gt;
      &lt;parameter value="{../1}{1}" name="request"/&gt;
      &lt;parameter value="{properties:content.xdocs}" name="projectDir"/&gt;
      &lt;parameter value="lm://dispatcher.structurer.resourceType." 
        name="resourceTypeBase"/&gt;
      &lt;parameter value=".xml.meta" name="metaExtension"/&gt;
      &lt;parameter value="resourceType" name="resourceTypeElement"/&gt;
      &lt;parameter value="http://apache.org/cocoon/lenya/page-envelope/1.0" 
        name="resourceTypeElementNS"/&gt;
      &lt;!--  Meta data based --&gt;
      &lt;location src="{uri}" /&gt;
    &lt;/act&gt;
    &lt;act type="RecursiveDirectoryTraversalAction"&gt;
      &lt;parameter value="{../1}{1}" name="request"/&gt;
      &lt;parameter value="{properties:dispatcher.theme}" name="projectFallback"/&gt;
      &lt;parameter value="{properties:dispatcher.theme-ext}" 
        name="projectExtension"/&gt;
      &lt;parameter value="{properties:resources}structurer/url/" name="projectDir"/&gt;
      &lt;!--  url
            project-based theme-based = directory-based / parent-directory based (recursively) --&gt;
      &lt;location src="{uri}" /&gt;
    &lt;/act&gt;
    &lt;act type="RecursiveDirectoryTraversalAction"&gt;
      &lt;parameter value="{../1}{1}" name="request"/&gt;
      &lt;parameter value="{properties:dispatcher.theme}" name="projectFallback"/&gt;
      &lt;parameter value="{properties:dispatcher.theme-ext}" 
        name="projectExtension"/&gt;
      &lt;parameter value="{properties:content.xdocs}" name="projectDir"/&gt;
      &lt;!--  xdocs  [depreciated]
            project-based theme-based = directory-based / parent-directory based (recursively) --&gt;
      &lt;location src="{uri}" /&gt;
    &lt;/act&gt;
    &lt;!-- themes-dir: project-application-based theme-dir-based --&gt;
    &lt;location 
      src="{lm:themer.project.dir}/{properties:dispatcher.theme}{properties:dispatcher.theme-ext}" 
      /&gt;
    &lt;!-- themes-dir: project-application-based default --&gt;
    &lt;location 
      src="{lm:themer.project.dir}/{properties:dispatcher.fallback.theme}{properties:dispatcher.fallback.theme-ext}" 
      /&gt;
    &lt;!-- themer: forrest-application-based theme-based --&gt;
    &lt;location 
      src="{lm:dispatcher.themer}/themes/{properties:dispatcher.theme}{properties:dispatcher.theme-ext}" 
      /&gt;
    &lt;!-- themer: forrest-application-based default --&gt;
    &lt;location 
      src="{lm:dispatcher.themer}/themes/{properties:dispatcher.fallback.theme}{properties:dispatcher.fallback.theme-ext}" 
      /&gt;
  &lt;/select&gt;
&lt;/match&gt; </pre>
</div>
<!--+ |end content-main +-->
</div>
</div>
<div id="footer">
<div class="lastmodified">
<script type="text/javascript">document.write("Last Published: " + document.lastModified);</script>
</div>
<div class="copyright">
            Copyright ©
             2002-2006 <a href="http://www.apache.org/licenses/">The Apache Software Foundation.</a> </div>
<!--+ |start compliance links +-->
<div id="siteinfo-compliance-links">
<a href="http://validator.w3.org/check?uri=referer">
<img alt="Valid XHTML 1.0!" height="31" src="http://www.w3.org/Icons/valid-xhtml10" width="88" />
</a>
<a href="http://jigsaw.w3.org/css-validator/check/referer">
<img alt="Valid CSS!" src="http://jigsaw.w3.org/css-validator/images/vcss" style="border:0;width:88px;height:31px" />
</a>
</div>
<!--+ |end compliance links +-->
<!-- |start siteinfo-credits -->
<div id="credit">
<a href="http://forrest.apache.org/">
<img alt="Built with Apache Forrest - logo" src="../images/built-with-forrest-button.png" style="width: 88px;height: 31px;" title="Built with Apache Forrest" />
</a>
<a href="http://cocoon.apache.org/">
<img alt="Built with Cocoon - logo" src="http://forrest.apache.org/images/built-with-cocoon.gif" style="" title="Built with Cocoon" />
</a>
</div>
<!--+ |end siteinfo-credits +-->
</div>
</div>
</body>
</html>
