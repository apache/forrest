<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta content="Apache Forrest" name="Generator">
<meta name="Forrest-version" content="0.9-dev">
<meta name="Forrest-skin-name" content="pelt">
<title>Generate an ASF mirrors page using interactive web form (v0.9-dev)</title>
<link type="text/css" href="../../skin/basic.css" rel="stylesheet">
<link media="screen" type="text/css" href="../../skin/screen.css" rel="stylesheet">
<link media="print" type="text/css" href="../../skin/print.css" rel="stylesheet">
<link type="text/css" href="../../skin/profile.css" rel="stylesheet">
<script src="../../skin/getBlank.js" language="javascript" type="text/javascript"></script><script src="../../skin/getMenu.js" language="javascript" type="text/javascript"></script><script src="../../skin/fontsize.js" language="javascript" type="text/javascript"></script>
<link rel="shortcut icon" href="../../favicon.ico">
</head>
<body onload="init()">
<script type="text/javascript">ndeSetTextSize();</script>
<div id="top">
<!--+
    |breadtrail
    +-->
<div class="breadtrail">
<a href="http://www.apache.org/">Apache Software Foundation</a> &gt; <a href="http://forrest.apache.org/">Apache Forrest</a><script src="../../skin/breadcrumbs.js" language="JavaScript" type="text/javascript"></script>
</div>
<!--+
    |header
    +-->
<div class="header">
<!--+
    |start group logo
    +-->
<div class="grouplogo">
<a href="http://www.apache.org/"><img class="logoImage" alt="Apache" src="../../images/apache-forrest.png" title="The Apache Software Foundation"></a>
</div>
<!--+
    |end group logo
    +-->
<!--+
    |start Project Logo
    +-->
<div class="projectlogo">
<a href="http://forrest.apache.org/"><img class="logoImage" alt="Forrest" src="../../images/project-logo.gif" title="Apache Forrest"></a>
</div>
<!--+
    |end Project Logo
    +-->
<!--+
    |start Search
    +-->
<div class="searchbox">
<form action="http://www.google.com/search" method="get" class="roundtopsmall">
<input value="forrest.apache.org" name="sitesearch" type="hidden"><input onFocus="getBlank (this, 'Search the site with google');" size="25" name="q" id="query" type="text" value="Search the site with google">&nbsp; 
                    <input name="Search" value="Search" type="submit">
</form>
</div>
<!--+
    |end search
    +-->
<!--+
    |start Tabs
    +-->
<ul id="tabs">
<li>
<a class="unselected" href="../../index.html">Welcome</a>
</li>
<li>
<a class="unselected" href="../../contrib.html">Developers</a>
</li>
<li class="current">
<a class="selected" href="../../versions/index.html">Versioned Docs</a>
</li>
<li>
<a class="unselected" href="../../pluginDocs/index.html">Plugins</a>
</li>
<li>
<a class="unselected" href="../../tools/index.html">Tools</a>
</li>
</ul>
<!--+
    |end Tabs
    +-->
</div>
</div>
<div id="main">
<div id="publishedStrip">
<!--+
    |start Subtabs
    +-->
<div id="level2tabs">
<a class="unselected" href="../../docs_0_80/index.html">0.80 (current)</a><a class="selected" href="../../docs_0_90/index.html">0.90-dev (under development)</a><a class="unselected" href="../../docs_0_70/index.html">0.70 (past)</a>
</div>
<!--+
    |end Endtabs
    +-->
<script type="text/javascript"><!--
document.write("Last Published: " + document.lastModified);
//  --></script>
</div>
<!--+
    |breadtrail
    +-->
<div class="breadtrail">

             &nbsp;
           </div>
<!--+
    |start Menu, mainarea
    +-->
<!--+
    |start Menu
    +-->
<div id="menu">
<div onclick="SwitchMenu('menu_selected_1.1', '../../skin/')" id="menu_selected_1.1Title" class="menutitle" style="background-image: url('../../skin/images/chapter_open.gif');">0.90-dev</div>
<div id="menu_selected_1.1" class="selectedmenuitemgroup" style="display: block;">
<div class="menuitem">
<a href="../../docs_0_90/index.html">Overview</a>
</div>
<div class="menuitem">
<a href="../../docs_0_90/your-project.html">Using Forrest</a>
</div>
<div onclick="SwitchMenu('menu_selected_1.1.3', '../../skin/')" id="menu_selected_1.1.3Title" class="menutitle" style="background-image: url('../../skin/images/chapter_open.gif');">How-To</div>
<div id="menu_selected_1.1.3" class="selectedmenuitemgroup" style="display: block;">
<div class="menuitem">
<a href="../../docs_0_90/howto/index.html">Overview</a>
</div>
<div onclick="SwitchMenu('menu_1.1.3.2', '../../skin/')" id="menu_1.1.3.2Title" class="menutitle">Install Forrest</div>
<div id="menu_1.1.3.2" class="menuitemgroup">
<div class="menuitem">
<a href="../../docs_0_90/build.html" title="Build and install the current                     unreleased version">Building Forrest from Source</a>
</div>
</div>
<div class="menuitem">
<a href="../../docs_0_90/upgrading_09.html">Upgrading to 0.9</a>
</div>
<div onclick="SwitchMenu('menu_1.1.3.4', '../../skin/')" id="menu_1.1.3.4Title" class="menutitle">Customize Forrest</div>
<div id="menu_1.1.3.4" class="menuitemgroup">
<div class="menuitem">
<a href="../../docs_0_90/sitemap-explain.html">Sitemaps explained</a>
</div>
<div class="menuitem">
<a href="../../docs_0_90/howto/howto-custom-html-source.html">Custom html source</a>
</div>
<div class="menuitem">
<a href="../../docs_0_90/project-sitemap.html">Project sitemap</a>
</div>
<div class="menuitem">
<a href="../../docs_0_90/howto/howto-editcss.html">Edit CSS (WYSIWYG)</a>
</div>
<div class="menuitem">
<a href="../../docs_0_90/howto/howto-pdf-tab.html" title="Generate one pdf-document for all pages of a tab">Create tab PDF</a>
</div>
<div class="menuitem">
<a href="../../docs_0_90/howto/howto-corner-images.html">CSS corner SVG</a>
</div>
</div>
<div onclick="SwitchMenu('menu_1.1.3.5', '../../skin/')" id="menu_1.1.3.5Title" class="menutitle">Integrate Forrest with tools</div>
<div id="menu_1.1.3.5" class="menuitemgroup">
<div class="menuitem">
<a href="../../docs_0_90/howto/howto-forrest-from-maven.html">Maven Integration</a>
</div>
<div class="menuitem">
<a href="../../docs_0_90/catalog.html">Using DTD Catalogs</a>
</div>
</div>
<div onclick="SwitchMenu('menu_1.1.3.6', '../../skin/')" id="menu_1.1.3.6Title" class="menutitle">Extend Forrest</div>
<div id="menu_1.1.3.6" class="menuitemgroup">
<div class="menuitem">
<a href="../../docs_0_90/howto/howto-buildPlugin.html">Build a Plugin</a>
</div>
<div class="menuitem">
<a href="../../docs_0_90/skin-package.html">Package new Skins</a>
</div>
</div>
<div class="menupage">
<div class="menupagetitle">Download mirror</div>
</div>
<div onclick="SwitchMenu('menu_1.1.3.8', '../../skin/')" id="menu_1.1.3.8Title" class="menutitle">Adding Documentation</div>
<div id="menu_1.1.3.8" class="menuitemgroup">
<div class="menuitem">
<a href="../../howto-howto.html" title="Instructions for writing                 a new howto-document">Write a How-to</a>
</div>
<div onclick="SwitchMenu('menu_1.1.3.8.2', '../../skin/')" id="menu_1.1.3.8.2Title" class="menutitle">Multipage HowTo</div>
<div id="menu_1.1.3.8.2" class="menuitemgroup">
<div class="menuitem">
<a href="../../docs_0_90/howto/multi/howto-multi.html">Introduction</a>
</div>
<div class="menuitem">
<a href="../../docs_0_90/howto/multi/step1.html">Step 1</a>
</div>
<div class="menuitem">
<a href="../../docs_0_90/howto/multi/step2.html">Step 2</a>
</div>
<div class="menuitem">
<a href="../../docs_0_90/howto/multi/step3.html">Step 3</a>
</div>
</div>
</div>
</div>
<div class="menuitem">
<a href="../../docs_0_90/faq.html">FAQs</a>
</div>
<div onclick="SwitchMenu('menu_1.1.5', '../../skin/')" id="menu_1.1.5Title" class="menutitle">Background</div>
<div id="menu_1.1.5" class="menuitemgroup">
<div class="menuitem">
<a href="../../docs_0_90/linking.html">Menus and Linking</a>
</div>
<div class="menuitem">
<a href="../../docs_0_90/searching.html">Search Options in Forrest</a>
</div>
<div class="menuitem">
<a href="../../docs_0_90/locationmap.html">Locationmap</a>
</div>
<div class="menuitem">
<a href="../../docs_0_90/properties.html">Properties system</a>
</div>
<div class="menuitem">
<a href="../../docs_0_90/sitemap-ref.html">Sitemap Reference</a>
</div>
<div class="menuitem">
<a href="../../docs_0_90/skins.html" title="About default skins, their naming and features">Skins</a>
</div>
<div class="menuitem">
<a href="../../docs_0_90/status-themes.html">Dispatcher versus Skins</a>
</div>
<div class="menuitem">
<a href="../../docs_0_90/cap.html">Sourcetype Action</a>
</div>
<div class="menuitem">
<a href="../../docs_0_90/validation.html">XML validation and entity resolution</a>
</div>
</div>
<div class="menuitem">
<a href="../../docs_0_90/changes.html">Changes</a>
</div>
<div class="menuitem">
<a href="../../docs_0_90/glossary.html">Glossary</a>
</div>
<div onclick="SwitchMenu('menu_1.1.8', '../../skin/')" id="menu_1.1.8Title" class="menutitle">Reference docs</div>
<div id="menu_1.1.8" class="menuitemgroup">
<div onclick="SwitchMenu('menu_1.1.8.1', '../../skin/')" id="menu_1.1.8.1Title" class="menutitle">DTD documentation</div>
<div id="menu_1.1.8.1" class="menuitemgroup">
<div class="menuitem">
<a href="../../dtdx/dtd-docs.html">Overview</a>
</div>
<div class="menuitem">
<a href="../../dtdx/document-v20.dtdx.html">document-v20</a>
</div>
<div class="menuitem">
<a href="../../dtdx/howto-v20.dtdx.html">howto-v20</a>
</div>
<div class="menuitem">
<a href="../../dtdx/faq-v20.dtdx.html">faq-v20</a>
</div>
<div class="menuitem">
<a href="../../dtdx/document-v13.dtdx.html">document-v13</a>
</div>
<div class="menuitem">
<a href="../../dtdx/howto-v13.dtdx.html">howto-v13</a>
</div>
<div class="menuitem">
<a href="../../dtdx/faq-v13.dtdx.html">faq-v13</a>
</div>
</div>
<div onclick="SwitchMenu('menu_1.1.8.2', '../../skin/')" id="menu_1.1.8.2Title" class="menutitle">Doc samples</div>
<div id="menu_1.1.8.2" class="menuitemgroup">
<div class="menuitem">
<a href="../../dtdx/document-v13.html">document-v13</a>
</div>
<div class="menuitem">
<a href="../../dtdx/document-v20.html">document-v20</a>
</div>
</div>
</div>
<div onclick="SwitchMenu('menu_1.1.9', '../../skin/')" id="menu_1.1.9Title" class="menutitle">Older Docs</div>
<div id="menu_1.1.9" class="menuitemgroup">
<div class="menuitem">
<a href="../../docs_0_90/primer.html">Forrest Primer</a>
</div>
<div class="menuitem">
<a href="../../docs_0_90/libre-intro.html">Libre</a>
</div>
<div class="menuitem">
<a href="../../docs_0_90/dreams.html">Dream list</a>
</div>
<div class="menuitem">
<a href="../../docs_0_90/howto/cvs-ssh/howto-cvs-ssh.html">CVS over SSH</a>
</div>
</div>
</div>
<div id="credit">
<hr>
        This is documentation for development version v0.9-dev
       (<a href="http://forrest.apache.org/versions/">More</a>)</div>
<div id="roundbottom">
<img style="display: none" class="corner" height="15" width="15" alt="" src="../../skin/images/rc-b-l-15-1body-2menu-3menu.png"></div>
<!--+
  |alternative credits
  +-->
<div id="credit2">
<a href="http://www.apache.org/events/current-event.html"><img border="0" title="ApacheCon" alt="ApacheCon - logo" src="http://www.apache.org/events/current-event-125x125.png" style="width: 125px;height: 125px;"></a>
</div>
</div>
<!--+
    |end Menu
    +-->
<!--+
    |start content
    +-->
<div id="content">
<div class="trail">Font size: 
	          &nbsp;<input value="Reset" class="resetfont" title="Reset text" onclick="ndeSetTextSize('reset'); return false;" type="button">      
	          &nbsp;<input value="-a" class="smallerfont" title="Shrink text" onclick="ndeSetTextSize('decr'); return false;" type="button">
	          &nbsp;<input value="+a" class="biggerfont" title="Enlarge text" onclick="ndeSetTextSize('incr'); return false;" type="button">
</div>
<h1>Generate an ASF mirrors page using interactive web form</h1>
<div id="front-matter">
<div id="motd-area">
        This is documentation for development version v0.9-dev
       (<a href="http://forrest.apache.org/versions/">More</a>)</div>
<div class="abstract">
      Include html form elements into a forrest-generated html page. For
      example, this enables building automated download mirror pages for ASF
      project websites.
    </div>
<div id="minitoc-area">
<ul class="minitoc">
<li>
<a href="#Intended-Audience">Intended Audience</a>
</li>
<li>
<a href="#Purpose">Purpose</a>
</li>
<li>
<a href="#Prerequisites">Prerequisites</a>
</li>
<li>
<a href="#Steps">Steps</a>
<ul class="minitoc">
<li>
<a href="#cgi">Add the mirrors.cgi as a raw file</a>
</li>
<li>
<a href="#html">Add the mirrors.html to xdocs directory</a>
</li>
<li>
<a href="#menu">Add a menu entry for Download</a>
</li>
<li>
<a href="#link">Cause the mirrors.html to be processed as an extra file</a>
</li>
<li>
<a href="#exclude">Exclude mirrors CGI token URIs from processing</a>
</li>
<li>
<a href="#forrest">Run 'forrest' to build your site</a>
</li>
</ul>
</li>
</ul>
</div>
</div>
<a name="N10010"></a><a name="Intended-Audience"></a>
<h2 class="underlined_10">Intended Audience</h2>
<div class="section">
<ul>
      
<li>Any Apache project that uses Forrest to generate their website
        will need to have a mirrors page.</li>
      
<li>Anyone interested in the use of embedding html form
        elements into a generated Forrest page.</li>
      
<li>Anyone needing to add extra documents to the processing.</li>
    
</ul>
</div>
<a name="N10021"></a><a name="Purpose"></a>
<h2 class="underlined_10">Purpose</h2>
<div class="section">
<p>
      All Apache projects use dynamically generated download pages which
      determine the closest mirror and provide an interactive list of the
      current alternative mirrors. This HowTo describes the procedure to
      generate the template page that is utilised by the mirrors.cgi script.
    </p>
<p>
      The mirrors.cgi and mirrors.html are "extra" documents, i.e. have no links
      from anywhere in the site. So we explain how to process additional files.
    </p>
</div>
<a name="N1002C"></a><a name="Prerequisites"></a>
<h2 class="underlined_10">Prerequisites</h2>
<div class="section">
<ul>
      
<li>Followed the documentation about
      <a href="http://www.apache.org/~bodewig/mirror.html">Making your
      downloads mirrorable</a> and
      <a href="http://www.apache.org/dev/mirrors.html">Apache Mirroring Information</a>
      .
      </li>
      
<li>Established your ASF distribution space as described.</li>
      
<li>Already building your project website with Forrest.</li>
    
</ul>
</div>
<a name="N10045"></a><a name="Steps"></a>
<h2 class="underlined_10">Steps</h2>
<div class="section">
<p>
     See the example for the Apache Forrest website. The following files are involved:
    </p>
<pre class="code">
$FORREST_HOME/site-author/content/xdocs/site.xml (search for "mirrors")
$FORREST_HOME/site-author/content/xdocs/mirrors.html
$FORREST_HOME/site-author/content/mirrors.cgi
$FORREST_HOME/site-author/conf/cli.xconf (search for "mirrors")
$FORREST_HOME/site-author/forrest.properties (search for "project.configfile")</pre>
<a name="N10051"></a><a name="cgi"></a>
<h3 class="underlined_5">Add the mirrors.cgi as a raw file</h3>
<p>
        As explained in the mirrors document, there will be a two-line CGI
        wrapper script at the top-level of your website called
        <span class="codefrag">mirrors.cgi</span>
      
</p>
<p>
        Utilising the Forrest concept of raw un-processed content, add the file
        as <span class="codefrag">src/documentation/mirrors.cgi</span> (copy the Forrest
        project's
        <a href="http://svn.apache.org/repos/asf/forrest/trunk/site-author/content/mirrors.cgi">mirrors.cgi</a>)
      </p>
<a name="N10068"></a><a name="html"></a>
<h3 class="underlined_5">Add the mirrors.html to xdocs directory</h3>
<p>
        This file contains the html content of your mirror page, including the
        html form elements which drive the mirror selection. It also contains
        the specific tokens that are interpreted by the mirrors.cgi script to
        add the list of mirrors and select the closest.
      </p>
<p>
        Add the file as <span class="codefrag">src/documentation/xdocs/mirrors.html</span> (Use
        the Forrest project's
        <a href="http://svn.apache.org/repos/asf/forrest/trunk/site-author/content/xdocs/mirrors.html">mirrors.html</a>
        as a template and edit it to suit.)
      </p>
<p>
        Note that the special tokens (e.g. [if-any http] [for http]) need to be
        encompassed by xml comments.
      </p>
<a name="N1007F"></a><a name="menu"></a>
<h3 class="underlined_5">Add a menu entry for Download</h3>
<p>
        Add an entry to your site.xml navigation. For example ...
      </p>
<pre class="code">

 &lt;about label="About"&gt;
  &lt;index label="Index" href="index.html"/&gt;
  &lt;license label="License" href="license.html"/&gt;
  &lt;download label="Download" href="http://forrest.apache.org/mirrors.cgi"/&gt;
  &lt;download_html href="mirrors.html"/&gt;&lt;!-- so the page is part of a tab --&gt;
  ...
      </pre>
<a name="N1008D"></a><a name="link"></a>
<h3 class="underlined_5">Cause the mirrors.html to be processed as an extra file</h3>
<p>
        Forrest gathers the links that are to be crawled, by reading site.xml
        and by finding any other internal links in the actual documents. There
        is no link to mirrors.html because it is an extra file that needs to be
        generated and skinned, but not linked in any way.
      </p>
<p>
        The Cocoon command-line interface
        (<a href="http://cocoon.apache.org/2.1/userdocs/offline/">CLI</a>)
        to the rescue. Add the following entry to your project's cli.xconf file.
        See the FAQ about adding and configuring a project-based
        <a href="../../docs_0_90/faq.html#cli-xconf">cli.xconf</a>
      
</p>
<pre class="code">

&lt;uris name="mirrors" follow-links="false"&gt;
  &lt;uri type="append" src="mirrors.html"/&gt;
&lt;/uris&gt;
      </pre>
<div class="note">
<div class="label">Note</div>
<div class="content">
        Due to Issue
        <a href="http://issues.apache.org/jira/browse/FOR-480">FOR-480</a>
        the generated mirrors.html will end up in forrest/main/site/mirrors.html
        rather than in the project's build directory. So use the following workaround
        in your cli.xconf file ...
      </div>
</div>
<p>
        This example comes from $FORREST_HOME/site-author/conf/cli.xconf file.
        The path is relative to $FORREST_HOME/main/webapp/ directory. A full
        pathname should also work.
      </p>
<pre class="code">

&lt;uris name="mirrors" follow-links="false"&gt;
  &lt;uri type="append" src="mirrors.html"
      dest="../../site-author/build/site"&gt;
  &lt;/uri&gt;
&lt;/uris&gt;
      </pre>
<a name="N100B4"></a><a name="exclude"></a>
<h3 class="underlined_5">Exclude mirrors CGI token URIs from processing</h3>
<p>
        The mirrors.html has special URIs which are processed by the mirrors CGI script.
        These URIs need to be excluded from processing by Cocoon. Add the following
        entries to your conf/cli.xconf ...
      </p>
<pre class="code">

&lt;!-- Exclude tokens used in URLs to ASF mirrors (interpreted by a CGI) --&gt;
&lt;exclude pattern="[preferred]/**"/&gt;
&lt;exclude pattern="[location]"/&gt;
      </pre>
<a name="N100C2"></a><a name="forrest"></a>
<h3 class="underlined_5">Run 'forrest' to build your site</h3>
<p>
        That is all that you need to do, Forrest will take care of it from
        there. Run the '<span class="codefrag">forrest site</span>' command, or forrestbot.
        The mirrors.html page will be generated with the skin applied.
      </p>
</div>
</div>
<!--+
    |end content
    +-->
<div class="clearboth">&nbsp;</div>
</div>
<div id="footer">
<!--+
    |start bottomstrip
    +-->
<div class="lastmodified">
<script type="text/javascript"><!--
document.write("Last Published: " + document.lastModified);
//  --></script>
</div>
<div class="copyright">
        Copyright &copy;
         2002-2010 <a href="http://www.apache.org/licenses/">The Apache Software Foundation. Licensed under Apache License 2.0</a>
<br>
    Apache, Apache Forrest, the Apache feather logo, and the Apache Forrest
    logos are trademarks of The Apache Software Foundation.
  </div>
<!--+
    |end bottomstrip
    +-->
</div>
</body>
</html>
