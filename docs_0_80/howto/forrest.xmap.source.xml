<?xml version="1.0" encoding="ISO-8859-1"?><document><header> <!-- <meta content="HTML Tidy, see www.w3.org" name="generator"/> --> <title>Annotated forrest.xmap</title></header><body><section><title>forrest.xmap</title><pre>
&lt;?xml version="1.0"?&gt;
&lt;!-- ===============================================
Pipelines defining all Source XML types Forrest can handle.
Converts from arbitrary formats to standard Forrest doc-v12 XML.

First, determines if a simple format file exists.
Candidates are: .html .ihtml .txt .sxw .jspwiki 

Otherwise, the default *.xml handling is used.  The XML's DTD type is
discovered using the SourceTypeAction, and an appropriate transformation
applied.  Thus to add new XML types, just define a new &lt;sourcetype&gt;
and an appropriate &lt;map:when&gt; handler.

Generates  :  Source XML, Body HTML for *.ehtml
Example URL:  http://localhost:8888/index.xml
Used by    :  *.html and *.pdf pipelines in sitemap.xmap
Uses       :  content/xdocs/**.xml

$Revision: 1.8 $
==================================================== --&gt;

&lt;map:sitemap xmlns:map="http://apache.org/cocoon/sitemap/1.0"&gt;
  &lt;map:components&gt;
    &lt;map:generators default="file"&gt;
      &lt;map:generator name="html"      src="org.apache.cocoon.generation.HTMLGenerator"&gt;
        &lt;jtidy-config&gt;WEB-INF/jtidy.properties&lt;/jtidy-config&gt;
      &lt;/map:generator&gt;
      &lt;map:generator name="text2xml" logger="sitemap.generator.textgenerator"
                     src="org.apache.cocoon.generation.TextGenerator"&gt;
       &lt;parameter name="localizable" value="true"/&gt;
      &lt;/map:generator&gt;
      &lt;map:generator name="exception"
                  src="org.apache.cocoon.generation.ParseExceptionGenerator"/&gt;
                  
    &lt;/map:generators&gt;
    &lt;map:serializers default="html"/&gt;
    &lt;map:matchers default="wildcard"/&gt;

    &lt;map:transformers default="xslt"&gt;
     &lt;map:transformer name="pattern"
                      src="org.apache.cocoon.transformation.PatternTransformer" 
                      logger="sitemap.transformer.pattern"&gt;
      &lt;parameter name="groups" value="true"/&gt;
     &lt;/map:transformer&gt;
     &lt;map:transformer name="lexer"
                      src="org.apache.cocoon.transformation.LexicalTransformer" 
                      logger="sitemap.transformer.lexer"&gt;
      &lt;parameter name="localizable" value="true"/&gt;
     &lt;/map:transformer&gt;
     &lt;map:transformer name="parser"
                      src="org.apache.cocoon.transformation.ParserTransformer" 
                      logger="sitemap.transformer.parser"&gt;
      &lt;parameter name="flatten" value="true"/&gt;
      &lt;parameter name="recovery" value="true"/&gt;
      &lt;parameter name="localizable" value="true"/&gt;
     &lt;/map:transformer&gt;
  
     &lt;map:transformer name="extparser"
                      src="org.apache.cocoon.transformation.ExtendedParserTransformer"
                      logger="sitemap.transformer.extendedparser"&gt;
     &lt;/map:transformer&gt;
    &lt;/map:transformers&gt;

    &lt;map:actions&gt;
      &lt;map:action logger="sitemap.action.sourcetype" name="sourcetype" src="org.apache.forrest.sourcetype.SourceTypeAction"&gt;
        &lt;sourcetype name="document-v10"&gt;
          &lt;document-declaration public-id="-//APACHE//DTD Documentation V1.0//EN" /&gt;
        &lt;/sourcetype&gt;
        &lt;sourcetype name="howto-v10"&gt;
          &lt;document-declaration public-id="-//APACHE//DTD How-to V1.0//EN" /&gt;
        &lt;/sourcetype&gt;
        &lt;sourcetype name="todo-v10"&gt;
          &lt;document-declaration public-id="-//APACHE//DTD Todo V1.0//EN" /&gt;
        &lt;/sourcetype&gt;
        &lt;sourcetype name="changes-v10"&gt;
          &lt;document-declaration public-id="-//APACHE//DTD Changes V1.0//EN" /&gt;
        &lt;/sourcetype&gt;
        &lt;sourcetype name="document-v11"&gt;
          &lt;document-declaration public-id="-//APACHE//DTD Documentation V1.1//EN" /&gt;
        &lt;/sourcetype&gt;
        &lt;sourcetype name="howto-v11"&gt;
          &lt;document-declaration public-id="-//APACHE//DTD How-to V1.1//EN" /&gt;
        &lt;/sourcetype&gt;
        &lt;sourcetype name="todo-v11"&gt;
          &lt;document-declaration public-id="-//APACHE//DTD Todo V1.1//EN" /&gt;
        &lt;/sourcetype&gt;
        &lt;sourcetype name="changes-v11"&gt;
          &lt;document-declaration public-id="-//APACHE//DTD Changes V1.1//EN" /&gt;
        &lt;/sourcetype&gt;
        &lt;sourcetype name="todo-v12"&gt;
          &lt;document-declaration public-id="-//APACHE//DTD Todo V1.2//EN" /&gt;
        &lt;/sourcetype&gt;
        &lt;sourcetype name="changes-v12"&gt;
          &lt;document-declaration public-id="-//APACHE//DTD Changes V1.2//EN" /&gt;
        &lt;/sourcetype&gt;
        &lt;sourcetype name="howto-v12"&gt;
          &lt;document-declaration public-id="-//APACHE//DTD How-to V1.2//EN" /&gt;
        &lt;/sourcetype&gt;
        &lt;sourcetype name="todo-v13"&gt;
          &lt;document-declaration public-id="-//APACHE//DTD Todo V1.3//EN" /&gt;
        &lt;/sourcetype&gt;
        &lt;sourcetype name="changes-v13"&gt;
          &lt;document-declaration public-id="-//APACHE//DTD Changes V1.3//EN" /&gt;
        &lt;/sourcetype&gt;
        &lt;sourcetype name="howto-v13"&gt;
          &lt;document-declaration public-id="-//APACHE//DTD How-to V1.3//EN" /&gt;
        &lt;/sourcetype&gt;
        &lt;sourcetype name="document-v20a"&gt;
          &lt;document-declaration public-id="-//APACHE//DTD Documentation V2.0a//EN" /&gt;
        &lt;/sourcetype&gt;
        &lt;sourcetype name="document-v20"&gt;
          &lt;document-declaration public-id="-//APACHE//DTD Documentation V2.0//EN" /&gt;
        &lt;/sourcetype&gt;
        &lt;sourcetype name="todo-v20"&gt;
          &lt;document-declaration public-id="-//APACHE//DTD Todo V2.0//EN" /&gt;
        &lt;/sourcetype&gt;
        &lt;sourcetype name="changes-v20"&gt;
          &lt;document-declaration public-id="-//APACHE//DTD Changes V2.0//EN" /&gt;
        &lt;/sourcetype&gt;
        &lt;sourcetype name="howto-v20"&gt;
          &lt;document-declaration public-id="-//APACHE//DTD How-to V2.0//EN" /&gt;
        &lt;/sourcetype&gt;
      &lt;/map:action&gt;
      &lt;map:action logger="sitemap.action.locale" name="locale" src="org.apache.cocoon.acting.LocaleAction"&gt;
      &lt;/map:action&gt;
    &lt;/map:actions&gt;
    &lt;map:selectors default="parameter"&gt;
    &lt;map:selector logger="sitemap.selector.parameter" name="parameter" src="org.apache.cocoon.selection.ParameterSelector" /&gt;
   &lt;map:selector logger="sitemap.selector.exception" name="exception"
                 src="org.apache.cocoon.selection.ExceptionSelector"&gt;
     &lt;exception name="syntax" class="net.sourceforge.chaperon.process.ParseException"/&gt;
     &lt;exception class="java.lang.Throwable" unroll="true"/&gt;
   &lt;/map:selector&gt;
      &lt;map:selector logger="sitemap.selector.config" name="config" src="org.apache.cocoon.selection.SimpleSelector" /&gt;
    &lt;/map:selectors&gt;
  &lt;/map:components&gt;

  &lt;map:resources&gt;
    &lt;map:resource name="transform-to-document"&gt;
      &lt;map:act type="sourcetype" src="{src}"&gt;
        &lt;map:select type="parameter"&gt;
          &lt;map:parameter name="parameter-selector-test" value="{sourcetype}" /&gt;

          &lt;map:when test="document-v10"&gt;
          &lt;!-- FIXME (JJP):  This should use the v12 now--&gt;
            &lt;map:transform src="{forrest:stylesheets}/docv10todocv11.xsl" /&gt;
          &lt;/map:when&gt;

          &lt;map:when test="document-v20a"&gt;
            &lt;map:transform src="{forrest:stylesheets}/docv20todocv12.xsl" /&gt;
          &lt;/map:when&gt;

          &lt;map:when test="document-v20"&gt;
            &lt;map:transform src="{forrest:stylesheets}/docv20todocv13.xsl" /&gt;
          &lt;/map:when&gt;

          &lt;map:when test="howto-v10"&gt;
            &lt;map:transform src="{forrest:stylesheets}/howto2document.xsl" /&gt;
          &lt;/map:when&gt;

          &lt;map:when test="howto-v11"&gt;
            &lt;map:transform src="{forrest:stylesheets}/howto2document.xsl" /&gt;
          &lt;/map:when&gt;
          &lt;map:when test="howto-v12"&gt;
            &lt;map:transform src="{forrest:stylesheets}/howto2document.xsl" /&gt;
          &lt;/map:when&gt;
          &lt;map:when test="howto-v13"&gt;
            &lt;map:transform src="{forrest:stylesheets}/howto2document.xsl" /&gt;
          &lt;/map:when&gt;
          &lt;map:when test="howto-v20"&gt;
            &lt;map:transform src="{forrest:stylesheets}/howto2document.xsl" /&gt;
          &lt;/map:when&gt;

          &lt;map:when test="todo-v10"&gt;
            &lt;map:transform src="{forrest:stylesheets}/todo2document.xsl" /&gt;
          &lt;/map:when&gt;

          &lt;map:when test="todo-v11"&gt;
            &lt;map:transform src="{forrest:stylesheets}/todo2document.xsl" /&gt;
          &lt;/map:when&gt;

          &lt;map:when test="todo-v12"&gt;
            &lt;map:transform src="{forrest:stylesheets}/todo2document.xsl" /&gt;
          &lt;/map:when&gt;

          &lt;map:when test="todo-v13"&gt;
            &lt;map:transform src="{forrest:stylesheets}/todo2document.xsl" /&gt;
          &lt;/map:when&gt;

          &lt;map:when test="todo-v20"&gt;
            &lt;map:transform src="{forrest:stylesheets}/todo2document.xsl" /&gt;
          &lt;/map:when&gt;

          &lt;map:when test="changes-v10"&gt;
            &lt;map:transform src="{forrest:stylesheets}/changesv10tochangesv11.xsl" /&gt;
            &lt;map:transform src="{forrest:stylesheets}/changes2document.xsl" /&gt;
          &lt;/map:when&gt;

          &lt;map:when test="changes-v11"&gt;
            &lt;map:transform src="{forrest:stylesheets}/changes2document.xsl" /&gt;
          &lt;/map:when&gt;

          &lt;map:when test="changes-v12"&gt;
            &lt;map:transform src="{forrest:stylesheets}/changes2document.xsl" /&gt;
          &lt;/map:when&gt;

          &lt;map:when test="changes-v13"&gt;
            &lt;map:transform src="{forrest:stylesheets}/changes2document.xsl" /&gt;
          &lt;/map:when&gt;

          &lt;map:when test="changes-v20"&gt;
            &lt;map:transform src="{forrest:stylesheets}/changes2document.xsl" /&gt;
          &lt;/map:when&gt;
          &lt;map:otherwise /&gt;
        &lt;/map:select&gt;
      &lt;/map:act&gt;
    &lt;/map:resource&gt;
</pre><section><title>Definition of File-Resolver-Resource</title><pre>
    &lt;map:resource name="file-resolver"&gt;
      &lt;map:select type="exists"&gt;
        &lt;map:when test="{project:content.xdocs}{uri}.ihtml"&gt;
          &lt;map:generate src="{project:content.xdocs}{uri}.ihtml" type="html" /&gt;
          &lt;map:transform src="{forrest:stylesheets}/html2document.xsl" /&gt;
          &lt;map:transform type="idgen" /&gt;
          &lt;map:serialize type="xml-document"/&gt;
        &lt;/map:when&gt;
        &lt;map:when test="{project:content.xdocs}{uri}.html"&gt;
          &lt;map:generate src="{project:content.xdocs}{uri}.html" type="html" /&gt;
          &lt;map:transform src="{forrest:stylesheets}/html2document.xsl" /&gt;
          &lt;map:transform type="idgen" /&gt;
          &lt;map:serialize type="xml-document"/&gt;
        &lt;/map:when&gt;
        &lt;map:when test="{project:content.xdocs}{uri}.txt"&gt;
          &lt;map:match type="regexp" pattern="^(.*?)([^/]*).xml$"&gt;
            &lt;map:generate type="text2xml" src="{project:content.xdocs}{1}{2}.txt" /&gt;
            &lt;map:transform src="{forrest:stylesheets}/text2document.xsl"&gt;
              &lt;map:parameter name="filename" value="{2}" /&gt;
            &lt;/map:transform&gt;
            &lt;map:serialize type="xml-document"/&gt;
          &lt;/map:match&gt;
        &lt;/map:when&gt;
        &lt;map:otherwise&gt;
        
          &lt;map:select type="exists"&gt;
             &lt;map:when test="{project:temp-dir}/input.xmap"&gt;
               &lt;map:mount uri-prefix=""
                          src="{project:temp-dir}/input.xmap" 
                          check-reload="yes" 
                          pass-through="true"/&gt;
            &lt;/map:when&gt;
          &lt;/map:select&gt;
        
          &lt;map:generate src="{project:content.xdocs}{uri}.xml" /&gt;
          &lt;map:call resource="transform-to-document"&gt;
            &lt;map:parameter name="src" value="{project:content.xdocs}{uri}.xml" /&gt;
          &lt;/map:call&gt;
          &lt;map:serialize type="xml-document"/&gt;
        &lt;/map:otherwise&gt;
      &lt;/map:select&gt;
    &lt;/map:resource&gt;
  &lt;/map:resources&gt;

  &lt;map:pipelines&gt;
    &lt;map:pipeline&gt;

      &lt;!-- ============================================================ --&gt;
      &lt;!-- INTERMEDIATE FORMATS                                         --&gt;
      &lt;!-- ============================================================ --&gt;

      &lt;map:match pattern="**body-*.html"&gt;
        &lt;map:select type="exists"&gt;
          &lt;map:when test="{project:content.xdocs}{1}{2}.ehtml"&gt;
            &lt;map:generate src="{project:content.xdocs}{1}{2}.ehtml" /&gt;
            &lt;map:transform src="{forrest:stylesheets}/html2htmlbody.xsl" /&gt;
            &lt;map:serialize type="xml" /&gt;
          &lt;/map:when&gt;
        &lt;/map:select&gt;
      &lt;/map:match&gt;

      &lt;!-- ============================================================ --&gt;
      &lt;!-- SOURCE FORMATS                                               --&gt;
      &lt;!-- ============================================================ --&gt;
</pre></section><section><title>Second Match for '**.xml'</title><pre>
      &lt;map:match pattern="**.xml"&gt;
        &lt;map:select type="config"&gt;
          &lt;map:parameter name="value" value="{defaults:i18n}"/&gt;
          &lt;map:when test="true"&gt;
          &lt;map:act type="locale"&gt;
            &lt;map:call resource="file-resolver"&gt;
              &lt;map:parameter name="uri" value="{../1}_{language}"/&gt;
            &lt;/map:call&gt;
          &lt;/map:act&gt;
          &lt;/map:when&gt;
          &lt;map:otherwise&gt;
            &lt;map:call resource="file-resolver"&gt;
              &lt;map:parameter name="uri" value="{1}"/&gt;
            &lt;/map:call&gt;
          &lt;/map:otherwise&gt;
        &lt;/map:select&gt;
      &lt;/map:match&gt;
      
    &lt;/map:pipeline&gt;
  &lt;/map:pipelines&gt;
&lt;/map:sitemap&gt;
</pre></section></section></body></document>