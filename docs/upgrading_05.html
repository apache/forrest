<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN""http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta content="Apache Forrest" name="Generator">
<meta name="Forrest-version" content="0.6-dev">
<meta name="Forrest-skin-name" content="pelt">
<title>Upgrading to Forrest 0.5</title>
<link type="text/css" href="../skin/basic.css" rel="stylesheet">
<link media="screen" type="text/css" href="../skin/screen.css" rel="stylesheet">
<link media="print" type="text/css" href="../skin/print.css" rel="stylesheet">
<link type="text/css" href="../skin/profile.css" rel="stylesheet">
<script src="../skin/getBlank.js" language="javascript" type="text/javascript"></script><script src="../skin/menu.js" language="javascript" type="text/javascript"></script>
<link rel="shortcut icon" href="../favicon.ico">
</head>
<body>
<div id="top">
<!--+
    |breadtrail
    +-->
<div class="breadtrail">
<a href="http://www.apache.org/">apache</a> &gt; <a href="http://forrest.apache.org/">forrest</a><script src="../skin/breadcrumbs.js" language="JavaScript" type="text/javascript"></script>
</div>
<!--+
    |header
    +-->
<div class="header">
<!--+
    |start group logo
    +-->
<div class="grouplogo">
<a href="http://www.apache.org/"><img class="logoImage" alt="Apache" src="../images/apache-forrest.png" title="The Apache Software Foundation"></a>
</div>
<!--+
    |end group logo
    +-->
<!--+
    |start Project Logo
    +-->
<div class="projectlogo">
<a href="http://forrest.apache.org/"><img class="logoImage" alt="Forrest" src="../images/project-logo.gif" title="Apache Forrest"></a>
</div>
<!--+
    |end Project Logo
    +-->
<!--+
    |start Search
    +-->
<div class="searchbox">
<div id="roundtopsmall">
<img style="display: none" class="cornersmall" height="5" width="5" alt="" src="../skin/images/rc-t-l-5-1body-2searchbox-3searchbox.png"></div>
<form action="http://www.google.com/search" method="get">
<input value="" name="sitesearch" type="hidden"><input onFocus="getBlank (this, 'Search the site:');" value="Search the site:" size="15" name="q" id="query" type="text">&nbsp; 
                    <input name="Search" value="Search" type="submit">
</form>
</div>
<!--+
    |end search
    +-->
<!--+
    |start Tabs
    +-->
<ul id="tabs">
<li>
<a class="base-not-selected" href="../index.html">Welcome</a>
</li>
<li>
<a class="base-not-selected" href="../contrib.html">Project</a>
</li>
<li class="current">
<a class="base-selected" href="../docs/your-project.html">Documentation</a>
</li>
<li>
<a class="base-not-selected" href="../howto/index.html">How-To</a>
</li>
</ul>
<!--+
    |end Tabs
    +-->
</div>
</div>
<div id="main">
<div id="published">
<script type="text/javascript" language="JavaScript"><!--
              document.write("Published: " + document.lastModified);
              //  --></script>
</div>
<div class="breadtrail">&nbsp;</div>
<!--+
    |start Menu, mainarea
    +-->
<!--+
    |start Menu
    +-->
<div id="menu">
<div onclick="SwitchMenu('menu_selected_1.1')" id="menu_selected_1.1Title" class="menutitle">Documentation</div>
<div id="menu_selected_1.1" class="selectedmenuitemgroup">
<div class="menuitem">
<a href="../docs/your-project.html">Using Forrest</a>
</div>
<div class="menuitem">
<a href="../docs/validation.html">XML Validation</a>
</div>
<div class="menuitem">
<a href="../docs/linking.html">Menus and Linking</a>
</div>
<div class="menuitem">
<a href="../docs/searching.html">Searching</a>
</div>
<div class="menuitem">
<a href="../docs/skins.html">Default Skins</a>
</div>
<div class="menuitem">
<a href="../docs/skin-package.html">Skin Packages</a>
</div>
<div class="menuitem">
<a href="../docs/forrest-contract.html">Our Contract</a>
</div>
<div class="menuitem">
<a href="../docs/compliance.html">Standards Compliance</a>
</div>
<div onclick="SwitchMenu('menu_1.1.9')" id="menu_1.1.9Title" class="menutitle">Advanced Topics</div>
<div id="menu_1.1.9" class="menuitemgroup">
<div class="menuitem">
<a href="../docs/catalog.html">Using DTD Catalogs</a>
</div>
<div class="menuitem">
<a href="../docs/sitemap-ref.html">Sitemap Reference</a>
</div>
<div class="menuitem">
<a href="../docs/project-sitemap.html">Project sitemap</a>
</div>
<div class="menuitem">
<a href="../docs/cap.html">Sourcetype Action</a>
</div>
</div>
<div onclick="SwitchMenu('menu_selected_1.1.10')" id="menu_selected_1.1.10Title" class="menutitle">Upgrading</div>
<div id="menu_selected_1.1.10" class="selectedmenuitemgroup">
<div class="menuitem">
<a href="../docs/upgrading_06.html">Upgrading to 0.6</a>
</div>
<div class="menupage">
<div class="menupagetitle">Upgrading to 0.5</div>
</div>
</div>
</div>
<div onclick="SwitchMenu('menu_1.2')" id="menu_1.2Title" class="menutitle">SubProjects</div>
<div id="menu_1.2" class="menuitemgroup">
<div class="menuitem">
<a href="../docs/forrestbar.html">ForrestBar</a>
</div>
<div class="menuitem">
<a href="../docs/forrestbot.html">Forrestbot</a>
</div>
<div class="menuitem">
<a href="../docs/forrestbot-web-interface.html">Forrestbot Webapp</a>
</div>
</div>
<div onclick="SwitchMenu('menu_1.3')" id="menu_1.3Title" class="menutitle">Reference docs</div>
<div id="menu_1.3" class="menuitemgroup">
<div onclick="SwitchMenu('menu_1.3.1')" id="menu_1.3.1Title" class="menutitle">DTD documentation</div>
<div id="menu_1.3.1" class="menuitemgroup">
<div class="menuitem">
<a href="../docs/dtd-docs.html">Overview</a>
</div>
<div class="menuitem">
<a href="../docs/document-v20.dtdx.html">document-v20</a>
</div>
<div class="menuitem">
<a href="../docs/howto-v20.dtdx.html">howto-v20</a>
</div>
<div class="menuitem">
<a href="../docs/faq-v20.dtdx.html">faq-v20</a>
</div>
<div class="menuitem">
<a href="../docs/document-v13.dtdx.html">document-v13</a>
</div>
<div class="menuitem">
<a href="../docs/howto-v13.dtdx.html">howto-v13</a>
</div>
<div class="menuitem">
<a href="../docs/faq-v13.dtdx.html">faq-v13</a>
</div>
</div>
<div onclick="SwitchMenu('menu_1.3.2')" id="menu_1.3.2Title" class="menutitle">Doc samples</div>
<div id="menu_1.3.2" class="menuitemgroup">
<div class="menuitem">
<a href="../docs/document-v13.html">document-v13</a>
</div>
<div class="menuitem">
<a href="../docs/wiki-sample.html">Wiki Reference</a>
</div>
<div class="menuitem">
<a href="../docs/oowriter.html">OpenOffice Writer</a>
</div>
</div>
</div>
<div onclick="SwitchMenu('menu_1.4')" id="menu_1.4Title" class="menutitle">Older Docs</div>
<div id="menu_1.4" class="menuitemgroup">
<div class="menuitem">
<a href="../docs/primer.html">Forrest Primer</a>
</div>
<div class="menuitem">
<a href="../docs/libre-intro.html">Libre</a>
</div>
<div class="menuitem">
<a href="../docs/dreams.html">Dream list</a>
</div>
</div>
<div id="credit"></div>
<div id="roundbottom">
<img style="display: none" class="corner" height="15" width="15" alt="" src="../skin/images/rc-b-l-15-1body-2menu-3menu.png"></div>
<!--+
  |alternativ credits
  +-->
</div>
<!--+
    |end Menu
    +-->
<!--+
    |start content
    +-->
<div id="content">
<div id="skinconf-txtlink"></div>
<div class="pdflink">
<a class="dida" href="upgrading_05.pdf"><img alt="PDF" src="../skin/images/pdfdoc.gif" class="skin"><br>
        PDF</a>
</div>
<h1>Upgrading to Forrest 0.5</h1>
<div id="minitoc-area">
<ul class="minitoc">
<li>
<a href="#Introduction">Introduction</a>
</li>
<li>
<a href="#New+Features">New Features</a>
</li>
<li>
<a href="#Upgrading+the+sitemap">Upgrading the sitemap</a>
</li>
<li>
<a href="#Version-specific+sitemaps">Version-specific sitemaps</a>
</li>
<li>
<a href="#Excluding+URLs%3A+filterlinks.xsl+removed+and+cli.xconf+added">Excluding URLs: filterlinks.xsl removed and cli.xconf added</a>
</li>
<li>
<a href="#Skin+invocation+changes">Skin invocation changes</a>
</li>
<li>
<a href="#Upgrading+skinconf.xml">Upgrading skinconf.xml</a>
</li>
<li>
<a href="#Upgrading+forrest.properties">Upgrading forrest.properties</a>
</li>
<li>
<a href="#Run+a+clean+target+after+upgrade">Run a clean target after upgrade</a>
</li>
<li>
<a href="#SVGs+should+omit+DOCTYPE+declarations">SVGs should omit DOCTYPE declarations</a>
</li>
<li>
<a href="#To+be+continued...">To be continued...</a>
</li>
</ul>
</div> 
    
<a name="N10010"></a><a name="Introduction"></a>
<h2 class="underlined_10">Introduction</h2>
<div class="section">
<p>
      This page describes changes to Forrest that affect people who are
      upgrading from 0.4 and earlier to the 0.5 version.
      Please post your upgrade experiences to the
      <a href="../mail-lists.html#forrest-dev">forrest-dev mailing list</a>.
      As more experience is gained, this document will be updated.  
      </p>
</div>

    
<a name="N1001E"></a><a name="New+Features"></a>
<h2 class="underlined_10">New Features</h2>
<div class="section">
<p>This new version includes many changes, as it as been under
        development for seven months (in part, awaiting the Cocoon 2.1 release).
        The following list shows some of the key new features for Forrest 0.5
        (for the full list of changes, see the
        <a href="../changes.html">change log</a>).
      </p>
<ul>
        
<li>Significantly faster (100% - 300%) command-line rendering</li>
        
<li>Docbook support. The DTDs are shipped. Document types are
        automatically detected by the sitemap and there is a basic stylesheet
        which converts DocBook documents to intermediate forrest document-v12
        for standard rendering. For rendering as full DocBook, see
        <a href="../faq.html#docbook">this FAQ entry</a>.
       </li>

        
<li>Configuration of URLs to ignore with cli.xconf configuration.</li>

        
<li>Skin enhancements.</li>

        
<li>The document-v12 DTDs are added. You can still use the old
        document-v11 DTDs if you would rather. However it is easy to upgrade
        - just change the document type declarations in you project's xdocs
        and run '<span class="codefrag">forrest validate-xdocs</span>'.</li>

        
<li>Automated handling of documents in Wiki syntax. See the
         fresh-site example which are generated when you
         '<span class="codefrag">forrest seed</span>' a new project.</li>

        
<li>The '<span class="codefrag">forrest backcopy</span>' target copies all
         types of content that you may have edited under the webapp while
         doing a '<span class="codefrag">forrest run</span>'.</li>

        
<li>Flag for email obfuscation.</li>

        
<li>Support for raw un-processed content. See 
        <a href="../faq.html#link_raw">this FAQ entry</a>.
        </li>

        
<li>Element <span class="codefrag">&lt;abstract&gt;</span> is now rendered in the 
        HTML output.</li>

        
<li>Images scale properly in PDF output. See also
        <a href="../faq.html#pdf_images">this FAQ entry</a>.
        </li>

        
<li>Configurable table-of-content depth with new 'toc' element in
        the <span class="codefrag">skinconf.xml</span> configuration.</li>
      
</ul>
</div>
    
<a name="N10071"></a><a name="Upgrading+the+sitemap"></a>
<h2 class="underlined_10">Upgrading the sitemap</h2>
<div class="section">
<p>
        In brief, Forrest 0.5 is <em>mostly</em> backwards-compatible for sites that do not define a custom sitemap.
        Between 0.4 and 0.5, the Forrest sitemap was completely rewritten.  Instead of a single sitemap.xmap doing
        everything, a 'driver' sitemap.xmap now delegates to a number of mounted subsitemaps handling different functional
        areas.  The new sitemap is fully described in the <a href="../docs/sitemap-ref.html">Sitemap Reference</a>.
      </p>
<p>Users that have overridden and augmented the Forrest 0.4 sitemap.xmap
      (run '<span class="codefrag">forrest overrides</span>' to see if your project has)
      will need to:</p>
<ol>
        
<li>Move their overridden sitemap (<span class="codefrag">src/documentation/sitemap.xmap</span>) out the way</li>
        
<li>Copy the new sitemap, $FORREST_HOME/context/sitemap.xmap, to <span class="codefrag">src/documentation</span>
</li>
        
<li>Reapply your customizations to the new sitemap.xmap.  Customizations can be determined by comparing your modified
          sitemap.xmap with 
          <a class="external" href="http://cvs.apache.org/viewcvs.cgi/*checkout*/xml-forrest/src/resources/conf/sitemap.xmap?rev=1.66&only_with_tag=FORREST_04">original
            Forrest 0.4 sitemap</a>.</li>
      
</ol>
</div>

    
<a name="N1009D"></a><a name="Version-specific+sitemaps"></a>
<h2 class="underlined_10">Version-specific sitemaps</h2>
<div class="section">
<p>Forrest 0.5 now supports <em>version-specific sitemaps</em>.  Ie., if your project's overridden sitemap is
        called <span class="codefrag">sitemap-0.5.xmap</span>, then this sitemap will be used in preference to
        <span class="codefrag">sitemap.xmap</span>, or any other sitemap-*.xmap variants.</p>
<p>So if, for example, one has:</p>
<pre class="code">
        src/documentation/sitemap.xmap
        src/documentation/sitemap-0.5.xmap
      </pre>
<p>Then Forrest 0.4 will use sitemap.xmap, and Forrest 0.5 will use sitemap-0.5.xmap.  This means users don't
        need to all upgrade to 0.5 at once.</p>
<p>As Forrest 0.5 has been split into multiple sitemaps, this version-specific behaviour is triggered for any
        *-0.5.xmap file.  For example, if one has:</p>
<pre class="code">
        src/documentation/sitemap.xmap
        src/documentation/forrest-0.5.xmap
      </pre>
<p>Then Forrest 0.4 will use sitemap.xmap, and Forrest 0.5 will use Forrest's own sitemap.xmap, plus the
        user-defined forrest-0.5.xmap file.</p>
<p>The same system prevents future compatibility problems, so Forrest 0.5 should continue to work when future
        (incompatible) sitemaps are present:</p>
<pre class="code">
        src/documentation/sitemap.xmap
        src/documentation/sitemap-0.5.xmap
        src/documentation/sitemap-0.6.xmap
        src/documentation/sitemap-0.7.xmap
      </pre>
<div class="frame note">
<div class="label">Note</div>
<div class="content">If your <span class="codefrag">forrest.properties</span> defines the
        <span class="codefrag">forrest.validate.sitemap.{includes,excludes}</span> properties, these will have to be updated to prevent
        validation of sitemaps from unused versions.  If undefined, Forrest will only validate sitemaps from the
        current version.</div>
</div>
</div>
    
<a name="N100D4"></a><a name="Excluding+URLs%3A+filterlinks.xsl+removed+and+cli.xconf+added"></a>
<h2 class="underlined_10">Excluding URLs: filterlinks.xsl removed and cli.xconf added</h2>
<div class="section">
<p>In Forrest 0.4 certain URLs could be excluded from command-line
      processing by overriding and editing
      <span class="codefrag">filterlinks.xsl</span> and so excluding the link nodes.
      </p>
<p>Forrest 0.5 uses the re-written command-line from Cocoon 2.1.1 which,
      apart from being much faster,
      <strong>does not use filterlinks.xsl</strong>.  Instead, patterns for
      command-line inclusion and exclusion can be specified in cli.xconf,
      as described in
      <a href="../faq.html#ignoring_javadocs">this FAQ entry</a>. There is
      already a default cli.xconf but you can over-ride that with your own if
      needed by copying <span class="codefrag">resources/conf/cli.xconf</span> from the Forrest
      distribution into your project's top-level directory.
      </p>
</div>

    
<a name="N100EE"></a><a name="Skin+invocation+changes"></a>
<h2 class="underlined_10">Skin invocation changes</h2>
<div class="section">
<p>Users with custom skins <em>may</em> need to update them, depending on what use they make of passed-in XSLT
        parameters.  If your custom skin does not appear to work with 0.5, look in Forrest's <span class="codefrag">sitemap.xmap</span>
        for occurrences of <span class="codefrag">{forrest:skin}</span>, and check that the callee (your XSLT) is expecting what the
        caller (the sitemap) is passing it.  Forrest skins can be used as a reference.</p>
</div>

    
<a name="N10101"></a><a name="Upgrading+skinconf.xml"></a>
<h2 class="underlined_10">Upgrading skinconf.xml</h2>
<div class="section">
<p>Look at the 
      <a class="external" href="http://cvs.apache.org/viewcvs/xml-forrest/src/resources/fresh-site/src/documentation/skinconf.xml.diff?r1=1.7%3AFORREST_04&r2=1.15%3AFORREST_05&diff_format=h">differences
        for the sample skinconf.xml</a> as a guide.
        You will need to update the internal DTD and add several new elements.
      </p>
</div>

    
<a name="N1010F"></a><a name="Upgrading+forrest.properties"></a>
<h2 class="underlined_10">Upgrading forrest.properties</h2>
<div class="section">
<p>Look at the 
      <a class="external" href="http://cvs.apache.org/viewcvs/xml-forrest/src/resources/fresh-site/forrest.properties.diff?r1=1.20%3AFORREST_04&r2=1.32%3AFORREST_05&diff_format=h">differences
        for the sample forrest.properties</a> as a guide. Note that
        project.sitemap has changed to project.sitemap-dir and note that
        cli.xconf now controls some settings that were previously controlled
        by forrest.properties, such as project.start-uri
      </p>
</div>

    
<a name="N1011D"></a><a name="Run+a+clean+target+after+upgrade"></a>
<h2 class="underlined_10">Run a clean target after upgrade</h2>
<div class="section">
<p>To avoid any issue with old classes being loaded, run a
       '<span class="codefrag">forrest clean</span>' just after you upgraded to this version.</p>
</div>

    
<a name="N1012A"></a><a name="SVGs+should+omit+DOCTYPE+declarations"></a>
<h2 class="underlined_10">SVGs should omit DOCTYPE declarations</h2>
<div class="section">
<div class="frame fixme">
<div class="label">Fixme (forrest-dev)</div>
<div class="content">Is this note still relevant?</div>
</div>
<p>In Forrest 0.5, sites that render SVGs may encounter ClassCastExceptions:</p>
<pre class="code">
javax.xml.transform.TransformerException: java.lang.ClassCastException
    at org.apache.xalan.transformer.TransformerImpl.transformNode(TransformerImpl.java:1326)
    at org.apache.xalan.transformer.TransformerImpl.run(TransformerImpl.java:3329)
...</pre>
<p>There appears to be a bug in Cocoon 2.1.1's SVG component where the DTD associated with SVGs cannot be
        resolved.  The workaround is to edit your <span class="codefrag">src/documentation/resources/images/*.svg</span> files, and
        comment out the <strong>&lt;!DOCTYPE ... &gt;</strong> declaration.</p>
</div>

    
<a name="N10145"></a><a name="To+be+continued..."></a>
<h2 class="underlined_10">To be continued...</h2>
<div class="section">
<p>..as more issues are discovered/remembered :)  Please send feedback to the 
      <a href="../mail-lists.html#forrest-dev">mailing list</a>.</p>
</div>
  
</div>
<!--+
    |end content
    +-->
<div class="clearboth">&nbsp;</div>
</div>
<div id="footer">
<!--+
    |start bottomstrip
    +-->
<div class="lastmodified">
<script type="text/javascript"><!--
document.write("Last Published: " + document.lastModified);
//  --></script>
</div>
<div class="copyright">
 Copyright &copy; 2002-2004 The Apache Software Foundation.</div>
<!--+
    |end bottomstrip
    +-->
</div>
</body>
</html>
